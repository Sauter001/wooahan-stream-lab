# 2차 개선: Dialogue System 기획

## 개요

MVP(Secret Phase까지 기능 완성) 이후, UX를 대화 느낌으로 개선하기 위한 대사 시스템 설계.

---

## 핵심 요구사항

### 1. 레벨별 대사 객체 교체 (Strategy Pattern)

```
Level 1-2 → MinaDialogue
Level 3-4 → AlexDialogue
Level 5   → SamDialogue
Secret    → MysteryDialogue
```

- 각 레벨 진입 시 DialogueProvider를 갈아끼움
- 동일한 ViolationType에 대해 캐릭터별로 다른 톤의 대사 출력

### 2. Paraphrasing을 통한 생동감

같은 의도의 대사를 여러 버전으로 준비하여 랜덤 출력:

```java
// 예시: for문 사용 위반
MinaDialogue.FOR_LOOP_VIOLATION =[
        "앗, for문을 사용하셨네요! 괜찮아요, 익숙한 방식이니까요.",
        "for문이시군요! Stream으로도 할 수 있어요, 같이 해볼까요?",
        "아이고~ for문 쓰셨네요! 한번 filter()로 바꿔볼까요?"
        ]
```

- 매번 같은 대사가 아닌 랜덤 선택으로 반복 플레이 시 지루함 방지
- 핵심 의도는 유지하되 표현만 다르게

---

## 설계 방향

### Validator → ViolationType 분리

현재:

```java
// Validator가 직접 에러 메시지 반환
return ValidationResult.error("변수 선언을 사용하지 마세요...");
```

개선:

```java
// Validator는 위반 타입만 반환
return ValidationResult.violation(ViolationType.VARIABLE_DECLARATION);
```

### ViolationType (Enum)

```java
public enum ViolationType {
    // 기본 위반
    FOR_LOOP,
    WHILE_LOOP,
    VARIABLE_DECLARATION,
    HELPER_METHOD,
    RECURSION,

    // 고급 위반
    FOR_EACH_TERMINAL,
    BLOCK_LAMBDA,
    MUTABLE_STATE,

    // 성공 케이스
    SUCCESS_PERFECT,
    SUCCESS_PASSED,

    // 힌트 요청
    HINT_REQUESTED
}
```

### DialogueProvider Interface

```java
public interface DialogueProvider {
    String getDialogue(ViolationType type);

    String getDialogue(ViolationType type, Map<String, Object> context);

    String getIntroduction();       // 레벨 시작 대사

    String getTransition();         // 다음 레벨 넘김 대사

    String getHint(int hintLevel);  // 힌트 (단계별)
}
```

### 캐릭터별 구현체

```java
public class MinaDialogue implements DialogueProvider {
    private static final Map<ViolationType, List<String>> DIALOGUES = Map.of(
            ViolationType.FOR_LOOP, List.of(
                    "앗, for문을 사용하셨네요! 괜찮아요~",
                    "for문이시군요! Stream으로도 할 수 있어요!",
                    "아이고~ for문! filter()로 바꿔볼까요?"
            ),
            ViolationType.SUCCESS_PERFECT, List.of(
                    "와! 해냈어요! 👏",
                    "정말 멋져요! 완벽해요!",
                    "대단해요! 첫 시도에 성공이라니!"
            )
            // ...
    );

    @Override
    public String getDialogue(ViolationType type) {
        List<String> options = DIALOGUES.get(type);
        return options.get(ThreadLocalRandom.current().nextInt(options.size()));
    }
}
```

---

## 캐릭터 성격 요약

| 캐릭터  | 레벨     | 톤        | 특징                           |
|------|--------|----------|------------------------------|
| Mina | 1-2    | 밝고 격려    | 이모티콘, 짧은 문장, "~해요!"          |
| Alex | 3-4    | 현실적 조언   | "음...", 침묵 활용, "~하는 게 어떨까요?" |
| Sam  | 5      | 엄격한 교육자  | 선언문, 원칙 강조, "(긴 침묵)"         |
| ???  | Secret | 신비로운 스타일 | 철학적 비유, "...", 긴 여운          |

---

## 상황별 대사 매핑

### 위반 유형별 캐릭터 반응 차이

| ViolationType | Mina       | Alex         | Sam              | ???              |
|---------------|------------|--------------|------------------|------------------|
| FOR_LOOP      | "괜찮아요~"    | "조금 아쉽네요"    | "(긴 침묵)...for문을" | "흐름을 거스르는군요"     |
| HELPER_METHOD | -          | "나쁘진 않지만..." | "불필요한 복잡성"       | "도움 없이 할 수 있습니다" |
| BLOCK_LAMBDA  | -          | -            | "장황함은 코드의 적"     | "간결함 속에 진리가"     |
| SUCCESS       | "와! 해냈어요!" | "좋습니다"       | "...좋습니다"        | "...완벽합니다"       |

---

## Context 기반 동적 대사

특정 상황에서 변수를 대사에 삽입:

```java
// 발견된 변수명을 대사에 포함
context.put("variableName","result");
dialogue.

getDialogue(VARIABLE_DECLARATION, context);
// → "앗, 'result'라는 변수를 선언하셨네요!"
```

---

## 구현 우선순위

1. **ViolationType enum 정의**
2. **DialogueProvider interface 정의**
3. **Validator들이 ViolationType 반환하도록 수정**
4. **캐릭터별 DialogueProvider 구현체 작성**
5. **GameEngine에서 레벨에 따라 DialogueProvider 교체**
6. **Paraphrasing용 대사 데이터 작성 (JSON or Enum)**

---

## 데이터 저장 방식 (검토 필요)

### Option 1: Java Enum + 하드코딩

- 장점: 타입 안전, IDE 자동완성
- 단점: 대사 수정 시 재컴파일

### Option 2: JSON 파일

- 장점: 런타임 수정 가능, 비개발자도 편집 가능
- 단점: 타입 안전성 낮음

### Option 3: 하이브리드

- ViolationType은 Enum
- 대사 데이터는 JSON
- DialogueLoader가 JSON을 읽어 Map으로 변환

