# 기능 명세 (2025-11-08)

## 개략적 실행 흐름
<img src="images/대략적%20실행%20흐름-v1.png" width="500"/>

## 🎮 게임 규칙

Stream Lab에서는 다음 규칙을 **강제**합니다:

```java
// ❌ 1. for, while, do-while 금지
for (int i = 0; i < list.size(); i++) { }

// ❌ 2. 재귀 함수 호출 금지  
public int sum(int n) { return n + sum(n-1); }

// ❌ 3. 헬퍼 메소드 추가 선언 금지
private void helper() { }

// ❌ 4. 블록 람다 금지
x -> { 
    int powered = x * x; 
    return powered; 
}

// ❌ 5. if, else, switch 등 직접 사용 금지 (filter 사용 권장)

// ⚠️ 6. 컬렉션 정의는 각 메소드에서 허용한 개수만 선언 가능
// 그 이상 선언 시 점수 감점 (실패 처리는 아님)
```

---

## 기능 명세 ✏

### 1. 인트로 및 초기화

#### 1.1 게임 시작 화면 출력

- [ ] Stream Lab 로고 및 타이틀 출력
- [ ] "Mastering Java Streams, One Challenge at a Time." 태그라인 표시
- [ ] 프로그램 버전 정보 출력

#### 입력 형식
```text
========================================
  _____ _                            
 / ____| |                           
| (___ | |_ _ __ ___  __ _ _ __ ___  
 \___ \| __| '__/ _ \/ _` | '_ ` _ \ 
 ____) | |_| | |  __/ (_| | | | | | |
|_____/ \__|_|  \___|\__,_|_| |_| |_|
       _           _     
      | |         | |    
      | |     __ _| |__  
      | |    / _` | '_ \ 
      | |___| (_| | |_) |
      |______\__,_|_.__/ 
                          
Mastering Java Streams, One Challenge at a Time.
v1.0.0
========================================
```

#### 1.2 프로필 로드 또는 생성

- [ ] `profile.json` 파일 존재 여부 확인
- [ ] 파일이 존재하면 프로필 정보 로드
  - [ ] 플레이어 이름 복원
  - [ ] 진행 상황 (완료한 레벨, 현재 레벨) 복원
  - [ ] 업적 정보 복원
  - [ ] 사용 가능한 힌트 개수 복원
- [ ] 파일이 존재하지 않으면 신규 프로필 생성
  - [ ] 플레이어 이름 입력 받기
  - [ ] 초기 진행 상황 설정 (레벨 0, 힌트 5개)
  - [ ] 빈 업적 목록 초기화
- [ ] 프로필 정보를 JSON 형식으로 저장 💭

#### 입력 형식
```text
프로필을 찾을 수 없습니다.
플레이어 이름을 입력해 주세요:
[플레이어 이름]
```

예시:
```text
프로필을 찾을 수 없습니다.
플레이어 이름을 입력해 주세요:
SangJun
```

#### 출력 형식
```text
환영합니다, [플레이어 이름]님!
현재 진행 상황을 불러오는 중...
```

예시:
```text
환영합니다, SangJun님!
현재 진행 상황을 불러오는 중...
```

#### 예외 상황

- [ ] 플레이어 이름이 공백 또는 빈 문자열인 경우
- [ ] 플레이어 이름이 20자를 초과하는 경우 💭
- [ ] 프로필 파일 파싱 실패 시 (손상된 JSON)

---

### 2. 튜토리얼

#### 2.1 튜토리얼 완료 여부 확인

- [ ] 프로필에서 튜토리얼 완료 플래그 확인
- [ ] 미완료 시 튜토리얼 시작
- [ ] 완료 시 메인 메뉴로 이동

#### 2.2 튜토리얼 진행

- [ ] Stream API 기본 개념 설명 출력
- [ ] 게임 규칙 상세 설명
- [ ] 간단한 예제 문제 제시
  - [ ] 예제: `List<Integer>` 에서 짝수만 필터링하여 합 구하기
- [ ] 사용자가 코드 작성 후 저장하면 자동 채점
- [ ] 채점 결과에 따라 피드백 제공
- [ ] 튜토리얼 완료 시 프로필에 저장

#### 출력 형식
```text
========================================
          튜토리얼
========================================

Stream API는 Java 8부터 도입된 함수형 프로그래밍 스타일의 컬렉션 처리 방법입니다.

이 게임에서는 다음 규칙을 준수해야 합니다:
1. for/while 루프 사용 금지
2. 재귀 함수 호출 금지
3. 헬퍼 메소드 추가 선언 금지
4. 블록 람다 금지
5. if/else/switch 직접 사용 금지

이제 간단한 예제를 풀어보세요!

문제: 주어진 리스트에서 짝수만 필터링하여 합을 구하세요.

public class Tutorial {
    public int filterEvenAndSum(List<Integer> numbers) {
        // 여기에 코드를 작성하세요
    }
}

solutions/Tutorial.java 파일을 수정하고 저장하세요.
```

#### 예외 상황

- [ ] 튜토리얼 파일이 존재하지 않는 경우
- [ ] 코드 작성 시간 초과 (30분 이상 소요) 💭

---

### 3. 시작 전 구현된 코드 기반 채점 및 레벨 해금

#### 3.1 기존 코드 검증

- [ ] `solutions/` 디렉토리에서 모든 레벨 파일 스캔
- [ ] 각 레벨별로 구현된 메소드가 있는지 확인
- [ ] 구현된 메소드에 대해 규칙 검증 실행
  - [ ] for/while 루프 검사
  - [ ] 재귀 함수 검사
  - [ ] 헬퍼 메소드 검사
  - [ ] 블록 람다 검사
  - [ ] 컬렉션 선언 개수 검사
- [ ] 규칙을 통과한 메소드에 대해 테스트 실행
- [ ] 테스트를 통과한 메소드는 완료 처리

#### 3.2 레벨 해금 판정

- [ ] Level 1은 항상 해금 상태
- [ ] Level N의 모든 문제가 완료되면 Level N+1 해금
- [ ] Level 5까지 모두 완료되면 Secret Phase 해금 가능 상태로 변경
- [ ] 해금 상태를 프로필에 저장

#### 출력 형식
```text
기존 코드를 검증하는 중...

Level 1: [완료]
  ✓ sumPositive
  ✓ filterEven
  ✓ mapToSquare

Level 2: [진행 중]
  ✓ flattenLists
  ✗ removeDuplicates (미구현)
  ✗ sortDescending (미구현)

Level 3: [잠김]

현재 Level 2가 해금되었습니다!
```

---

### 4. 사용자가 현재 해금된 레벨을 구현

#### 4.1 메인 메뉴 표시

- [ ] 현재 해금된 레벨 목록 출력
- [ ] 각 레벨의 완료 상태 표시 (완료/진행 중/잠김)
- [ ] 사용자 선택 입력 받기
  - [ ] 레벨 선택 (1-5)
  - [ ] 업적 확인 (A)
  - [ ] 프로필 보기 (P)
  - [ ] 종료 (Q)

#### 입력 형식
```text
========================================
          메인 메뉴
========================================
1. Level 1 [완료] ⭐⭐⭐
2. Level 2 [진행 중] ⭐⭐☆
3. Level 3 [잠김]
4. Level 4 [잠김]
5. Level 5 [잠김]

A. 업적 확인
P. 프로필 보기
Q. 종료

선택:
[선택 입력]
```

예시:
```text
선택: 2
```

#### 4.2 레벨 설명 및 문제 제시

- [ ] 선택한 레벨의 설명 출력
- [ ] 해당 레벨에서 구현해야 할 메소드 목록 출력
- [ ] 각 메소드의 요구사항 및 제약사항 출력
- [ ] 테스트 케이스 예시 출력 💭

#### 출력 형식
```text
========================================
          Level 2: 중급 변환
========================================

이번 레벨에서는 Stream의 중급 변환 기법을 학습합니다.

구현해야 할 메소드:
1. flattenLists: 중첩 리스트를 평탄화
2. removeDuplicates: 중복 제거
3. sortDescending: 내림차순 정렬

제약사항:
- 컬렉션 선언: 각 메소드당 최대 1개

solutions/Level2.java 파일을 수정하고 저장하세요.
파일이 저장되면 자동으로 채점이 시작됩니다.
```

#### 4.3 실시간 코드 감시 및 피드백

- [ ] FileWatcher를 사용하여 `solutions/Level*.java` 파일 감시
- [ ] 파일 저장 감지 시 자동으로 채점 시작
- [ ] 채점 결과를 실시간으로 콘솔에 출력
- [ ] 규칙 위반 시 상세한 피드백 제공
  - [ ] 위반한 규칙 종류
  - [ ] 위반 위치 (라인 번호)
  - [ ] 수정 방법 제안
- [ ] 테스트 실패 시 실패한 케이스 정보 제공

#### 출력 형식
```text
파일 변경 감지: Level2.java

규칙 검증 중...
✓ 루프 없음
✓ 재귀 없음
✓ 헬퍼 메소드 없음
✓ 블록 람다 없음
✓ 컬렉션 선언 개수 적합

테스트 실행 중...

flattenLists:
  ✓ 테스트 1 통과
  ✓ 테스트 2 통과
  ✓ 테스트 3 통과
  [3/3 통과] ⭐

removeDuplicates:
  ✓ 테스트 1 통과
  ✗ 테스트 2 실패
    입력: [1, 2, 2, 3]
    기대값: [1, 2, 3]
    실제값: [1, 2]
  [1/3 통과]
```

#### 예외 상황

- [ ] 감시 중인 파일이 삭제된 경우
- [ ] 파일 권한 문제로 읽기 실패
- [ ] 파일 내용이 유효하지 않은 Java 코드인 경우
- [ ] 컴파일 에러 발생 시

---

### 5. 해당 레벨 메소드 완료 시 채점 및 다음 레벨 해금

#### 5.1 레벨 완료 판정

- [ ] 해당 레벨의 모든 메소드가 테스트를 통과했는지 확인
- [ ] 완료 시 레벨 완료 애니메이션 출력 💭
- [ ] 획득한 점수 및 보너스 계산
  - [ ] 완벽한 구현 (규칙 위반 0회): +5점
  - [ ] 빠른 완료 (평균 시간 이하): +3점
  - [ ] 힌트 미사용: +2점
- [ ] 업적 달성 여부 확인 및 알림
- [ ] 다음 레벨 해금
- [ ] 프로필 업데이트 및 저장

#### 출력 형식
```text
========================================
     🎉 Level 2 완료! 🎉
========================================

점수: 100/100
보너스:
  ✓ 완벽한 구현 +5
  ✓ 빠른 완료 +3
  ✓ 힌트 미사용 +2

총점: 110점

새로운 업적 달성!
🏆 "중급 마스터" - Level 2를 완벽하게 클리어

Level 3이 해금되었습니다!

계속하려면 아무 키나 누르세요...
```

#### 5.2 레벨 통계 기록

- [ ] 각 레벨별 완료 시간 기록
- [ ] 시도 횟수 기록
- [ ] 사용한 힌트 개수 기록
- [ ] 최고 점수 기록
- [ ] 통계 정보를 프로필에 저장

---

### 6. Secret Phase

#### 6.1 Secret Phase 진입 조건

- [ ] Level 1~5까지 모두 완료
- [ ] `Secret.unlock()` 메소드 호출 시 Base64 인코딩된 문자열 반환
- [ ] 해당 문자열을 디코딩하면 재귀로 구현된 코드 출력
- [ ] 사용자는 동일한 출력을 Stream으로 구현해야 함

#### 6.2 Secret Phase 진입 방법 힌트

- [ ] AutoGrader.java 주석에 힌트 숨김
```java
/**
 * For those who dare...
 * Magic formula: sqrt(sum of first 10 primes)
 * Call: triggerSecret(answer)
 */
```
- [ ] 정답: `sqrt(2+3+5+7+11+13+17+19+23+29) = sqrt(129) ≈ 11.36` → 정수 11 또는 12
- [ ] `AutoGrader.triggerSecret(11)` 호출 시 Secret Phase 활성화

#### 6.3 Secret Phase 문제

- [ ] Base64 디코딩 시 나타나는 재귀 코드 예시:
```java
// 디코딩된 코드 (재귀 버전)
public int fibonacci(int n) {
    if (n <= 1) return n;
    return fibonacci(n - 1) + fibonacci(n - 2);
}
```
- [ ] 사용자는 이를 Stream으로 구현해야 함
- [ ] 모든 테스트 케이스에서 동일한 출력을 내야 함
- [ ] 만점을 받으면 Secret Phase 클리어

#### 출력 형식
```text
========================================
     🔐 Secret Phase 🔐
========================================

축하합니다! 숨겨진 도전 과제를 발견했습니다.

다음 코드와 동일한 동작을 Stream으로 구현하세요:

[Base64 디코딩된 재귀 코드]

제약사항:
- 모든 일반 규칙 적용
- 추가 제약: 메소드 시그니처 변경 불가

solutions/SecretLevel.java 파일을 작성하세요.
```

#### 예외 상황

- [ ] Level 5 미완료 상태에서 Secret Phase 접근 시도
- [ ] 잘못된 triggerSecret 매개변수 입력

---

## 🎯 예외 처리 및 재입력

### 공통 예외 처리

- 잘못된 입력 시 `IllegalArgumentException` 또는 `IllegalStateException`을 발생시키고, `[ERROR]`로 시작하는 메시지를 출력한 후 **해당 부분부터 입력을 다시 받는다**. (프로그램 종료 X)
- Exception이 아닌 명확한 유형의 예외 처리

### 각 단계별 예외 상황

#### 프로필 관련
- [ ] 프로필 파일 읽기 실패
- [ ] 프로필 파일 쓰기 실패
- [ ] 유효하지 않은 JSON 형식

#### 코드 검증 관련
- [ ] 소스 파일이 존재하지 않음
- [ ] 소스 파일 읽기 실패
- [ ] 파싱 에러 (유효하지 않은 Java 코드)
- [ ] 컴파일 에러
- [ ] 테스트 실행 시간 초과

#### 게임 진행 관련
- [ ] 잠긴 레벨 접근 시도
- [ ] 유효하지 않은 메뉴 선택
- [ ] 파일 감시 중 시스템 에러

---

## 📊 테스트 계획

### 단위 테스트

- [ ] Lexer 테스트 (20개 이상)
- [ ] Parser 테스트 (30개 이상)
- [ ] AST 테스트 (20개 이상)
- [ ] RuleChecker 테스트 (15개 이상)
- [ ] GameEngine 테스트 (25개 이상)

### 통합 테스트

- [ ] 전체 게임 플로우 테스트
- [ ] 레벨 진행 테스트
- [ ] 프로필 저장/로드 테스트
- [ ] 실시간 파일 감시 테스트

### 엔드-투-엔드 테스트

- [ ] 튜토리얼부터 Secret Phase까지 전체 플레이 테스트
- [ ] 다양한 에러 케이스 테스트

---

## 📝 커밋 규칙

* AngularJS Git Commit Message Conventions을 따른다
* 기능 목록 단위로 커밋
* 커밋 메시지 형식:
  - `feat: 기능 추가`
  - `fix: 버그 수정`
  - `refactor: 코드 리팩토링`
  - `test: 테스트 코드 추가`
  - `docs: 문서 수정`
  - `style: 코드 포매팅`

---

## 💭 구현 시 고려사항

### 성능 목표

- 파싱 시간: 1000줄 코드 < 500ms
- 실시간 피드백 지연: < 1초
- 메모리 사용: < 500MB

### 사용자 경험

- 직관적인 인터페이스
- 명확한 에러 메시지
- 단계별 가이드 제공
- 진행 상황 실시간 표시

### 확장성

- 새로운 레벨 추가 용이
- 새로운 규칙 추가 용이
- 다양한 테스트 케이스 지원

---

## 🏗 시스템 아키텍처

### 레이어 구조

```
UI Layer (Console Interface, Animation)
         ↓
Game Layer (Level Manager, Progress, Hints)
         ↓
Analysis Layer (Static Analyzer, Pattern Matcher)
         ↓
Parser Layer (Lexer, Parser, AST)
```

### 주요 컴포넌트

1. **Parser Layer**
  - Lexer: 어휘 분석
  - Parser: 구문 분석
  - AST: 추상 구문 트리

2. **Analyzer Layer**
  - RuleChecker: 규칙 검사
  - LoopDetector: 루프 감지
  - RecursionDetector: 재귀 감지

3. **Game Layer**
  - GameEngine: 게임 엔진
  - LevelManager: 레벨 관리
  - PlayerProfile: 플레이어 프로필
  - AchievementSystem: 업적 시스템

4. **UI Layer**
  - GameUI: 게임 인터페이스
  - AnimationEngine: 애니메이션
  - ColorPrinter: 색상 출력

---

## 📂 디렉토리 구조

```
stream-lab/
├── src/
│   ├── parser/              # 파서 구현
│   ├── analyzer/            # 정적 분석기
│   ├── game/                # 게임 시스템
│   ├── challenges/          # 문제 정의
│   ├── ui/                  # 사용자 인터페이스
│   ├── util/                # 유틸리티
│   └── Main.java
├── solutions/               # 학생 코드 작성 위치
├── test/                    # 테스트
├── docs/                    # 문서
├── README.md
├── build.gradle
└── .gitignore
```
